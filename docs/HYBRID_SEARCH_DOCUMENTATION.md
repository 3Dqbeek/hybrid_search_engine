# ๐ ะะพะบัะผะตะฝัะฐัะธั: ะะธะฑัะธะดะฝัะน ะะพะธัะบะพะฒัะน ะะฒะธะถะพะบ

## ๐ ะะฑะทะพั

**ะะฐ, ะผั ะธัะฟะพะปัะทัะตะผ Elasticsearch** ะบะฐะบ ะพัะฝะพะฒั ะฟะพะธัะบะพะฒะพะน ะธะฝััะฐััััะบัััั, ะฝะพ ะฟะพะฒะตัั ะฝะตะณะพ ัะตะฐะปะธะทะพะฒะฐะฝ ะณะธะฑัะธะดะฝัะน ะดะฒะธะถะพะบ ั ะบะฐััะพะผะฝัะผะธ ะฐะปะณะพัะธัะผะฐะผะธ ัะฐะฝะถะธัะพะฒะฐะฝะธั. ะญัะพ **ะณะธะฑัะธะดะฝะฐั ะฐััะธัะตะบัััะฐ**: Elasticsearch ะฟัะตะดะพััะฐะฒะปัะตั ะฑัััััะน BM25 ะฟะพะธัะบ ะธ ััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั, ะฐ ะฝะฐั ะดะฒะธะถะพะบ ะดะพะฑะฐะฒะปัะตั ัะตะผะฐะฝัะธัะตัะบะธะน ัะปะพะน, keyword density scoring ะธ ะผะฝะพะณะพัะฐะบัะพัะฝะพะต ัะฐะฝะถะธัะพะฒะฐะฝะธะต.

## ๐๏ธ ะััะธัะตะบัััะฐ ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะะะะะะะะซะ ะะะะกะะะะซะ ะะะะะะ                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
        โโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโ
        โ                                       โ
โโโโโโโโโผโโโโโโโโโ                    โโโโโโโโโโโผโโโโโโโโโ
โ QueryAnalyzer  โ                    โ Multi-Stage      โ
โ                โ                    โ Retrieval        โ
โ โข Intent       โ                    โ                  โ
โ โข Keywords     โ                    โ โข BM25 (ES)      โ
โ โข LLM Expand   โ                    โ โข Semantic       โ
โโโโโโโโโฌโโโโโโโโโ                    โโโโโโโโโโโฌโโโโโโโโโ
        โ                                       โ
        โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
        โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโ
        โ     Multi-Factor Scoring Engine       โ
        โ                                       โ
        โ  โข BM25 Score (30%)                   โ
        โ  โข Semantic Score (25%)               โ
        โ  โข Keyword Density (25%)              โ
        โ  โข Exact Match (15%)                  โ
        โ  โข Context Boost (8%)                  โ
        โ  โข Proximity/Position (7%)            โ
        โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
        โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโ
        โ      Elasticsearch (ะะฐะทะฐ ะดะฐะฝะฝัั)      โ
        โ                                       โ
        โ  โข ะะฝะดะตะบัะฐัะธั ะดะพะบัะผะตะฝัะพะฒ              โ
        โ  โข BM25 ะฟะพะธัะบ                         โ
        โ  โข ะฅัะฐะฝะตะฝะธะต ะผะตัะฐะดะฐะฝะฝัั                โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ ะัะพัะตัั ะฟะพะธัะบะฐ (Step-by-Step)

### Stage 1: Query Understanding (ะะพะฝะธะผะฐะฝะธะต ะทะฐะฟัะพัะฐ)

**ะัะพะด:** ะะพะปัะทะพะฒะฐัะตะปััะบะธะน ะทะฐะฟัะพั (ะฝะฐะฟัะธะผะตั: "ะฟะพะบะฐะถะธ ะฝะตะดะพะฒะพะปัะฝัั ะบะปะธะตะฝัะพะฒ ะบะพัะพััะต ะถะฐะปะพะฒะฐะปะธัั")

**ะะฑัะฐะฑะพัะบะฐ:**

1. **Intent Detection** โ ะพะฟัะตะดะตะปะตะฝะธะต ะฝะฐะผะตัะตะฝะธั:
   ```python
   # ะะฟัะตะดะตะปัะตั ัะธะฟ ะทะฐะฟัะพัะฐ:
   - "ะฒัะพะดััะธะต_ะทะฒะพะฝะบะธ" โ ัะธะปัััะฐัะธั ะฟะพ ัะธะฟั ะทะฒะพะฝะบะฐ
   - "ะฝะตะดะพะฒะพะปัััะฒะพ_ะบะปะธะตะฝัะฐ" โ ะฟะพะธัะบ ะฟัะพะฑะปะตะผ
   - "ะฟัะพะฑะปะตะผั_ั_ะพะฟะตัะฐัะพัะพะผ" โ ะถะฐะปะพะฑั ะฝะฐ ะพะฟะตัะฐัะพัะพะฒ
   - "ะฟัะพะดะฐะถะธ" โ ััะฟะตัะฝัะต ะฟัะพะดะฐะถะธ
   ```

2. **Keyword Extraction** โ ะธะทะฒะปะตัะตะฝะธะต ะบะปััะตะฒัั ัะปะพะฒ:
   ```python
   # ะฃะฑะธัะฐะตั ััะพะฟ-ัะปะพะฒะฐ: "ะฟะพะบะฐะถะธ", "ะฝะฐะนะดะธ", "ะณะดะต"
   # ะะตะทัะปััะฐั: ["ะฝะตะดะพะฒะพะปัะฝัั", "ะบะปะธะตะฝัะพะฒ", "ะถะฐะปะพะฒะฐะปะธัั"]
   ```

3. **Entity Extraction** โ ะธะทะฒะปะตัะตะฝะธะต ัััะฝะพััะตะน:
   ```python
   {
     "call_types": ["ะัะพะดััะธะน ะทะฒะพะฝะพะบ"],  # ะตัะปะธ ะตััั ะฒ ะทะฐะฟัะพัะต
     "emotions": ["negative"],
     "operators": []  # ะตัะปะธ ัะฟะพะผัะฝััะพ ะธะผั
   }
   ```

4. **LLM Query Expansion** โ ัะฐััะธัะตะฝะธะต ัะตัะตะท LLM:
   ```python
   # ะัะธะณะธะฝะฐะป: "ะฝะตะดะพะฒะพะปัะฝัะน ะบะปะธะตะฝั"
   # ะะฐััะธัะตะฝะฝัะน: "ะฝะตะดะพะฒะพะปัะฝัะน ะบะปะธะตะฝั ะถะฐะปัะตััั ะฝะฐ ะบะฐัะตััะฒะพ ะพะฑัะปัะถะธะฒะฐะฝะธั"
   # ะะพะฝัะตะฟัะธะธ: ["ะถะฐะปะพะฑะฐ", "ะฝะตะดะพะฒะพะปัััะฒะพ", "ะฟัะพะฑะปะตะผะฐ", "ัะฐััััะพะนััะฒะพ"]
   ```

### Stage 2: Multi-Stage Retrieval (ะะฝะพะณะพััะพะฒะฝะตะฒะฐั ะฒัะฑะพัะบะฐ)

#### 2a. BM25 Search (Elasticsearch)

**ะงัะพ ะฟัะพะธััะพะดะธั:**
- ะัะฟะพะปะฝัะตััั ะฑัััััะน BM25 ะฟะพะธัะบ ะฒ Elasticsearch
- ะัะฟะพะปัะทัะตััั `multi_match` ะทะฐะฟัะพั ะฟะพ ะฟะพะปัะผ:
  - `text_full^3` (ะฒะตั 3)
  - `text_clean_full^2` (ะฒะตั 2)
  - `text_summary^1` (ะฒะตั 1)
  - `tags^2` (ะฒะตั 2)

**ะะตะทัะปััะฐั:** ะขะพะฟ-500 ะบะฐะฝะดะธะดะฐัะพะฒ ั BM25 ัะบะพัะพะผ

**ะคะพัะผัะปะฐ BM25:**
```
score(q, d) = ฮฃ IDF(qi) ร f(qi, d) ร (k1 + 1) / (f(qi, d) + k1 ร (1 - b + b ร |d| / avgdl))
```

ะะดะต:
- `f(qi, d)` โ ัะฐััะพัะฐ ัะปะพะฒะฐ ะฒ ะดะพะบัะผะตะฝัะต
- `IDF(qi)` โ ะพะฑัะฐัะฝะฐั ัะฐััะพัะฐ ะดะพะบัะผะตะฝัะฐ
- `|d|` โ ะดะปะธะฝะฐ ะดะพะบัะผะตะฝัะฐ
- `avgdl` โ ััะตะดะฝัั ะดะปะธะฝะฐ ะดะพะบัะผะตะฝัะฐ

#### 2b. Semantic Search (E5-large embeddings)

**ะงัะพ ะฟัะพะธััะพะดะธั:**
1. ะะตะฝะตัะฐัะธั embedding ะดะปั ะทะฐะฟัะพัะฐ (1024 ัะฐะทะผะตัะฝะพััะธ)
2. ะะพะธัะบ 100 ะบะฐะฝะดะธะดะฐัะพะฒ ัะตัะตะท Elasticsearch (ะฑะฐะทะพะฒะฐั ัะธะปัััะฐัะธั)
3. ะะตะฝะตัะฐัะธั embeddings ะดะปั ัะตะบััะพะฒ ะบะฐะฝะดะธะดะฐัะพะฒ
4. ะััะธัะปะตะฝะธะต ะบะพัะธะฝััะฝะพะณะพ ััะพะดััะฒะฐ

**ะะตะทัะปััะฐั:** ะขะพะฟ-100 ะบะฐะฝะดะธะดะฐัะพะฒ ั semantic ัะบะพัะพะผ (0-1)

**ะคะพัะผัะปะฐ ะบะพัะธะฝััะฝะพะณะพ ััะพะดััะฒะฐ:**
```
cosine_similarity = (A ยท B) / (||A|| ร ||B||)
```

#### 2c. Candidate Merge (ะะฑัะตะดะธะฝะตะฝะธะต)

- ะะฑัะตะดะธะฝะตะฝะธะต ัะตะทัะปััะฐัะพะฒ ะธะท BM25 ะธ Semantic
- ะะตะดัะฟะปะธะบะฐัะธั ะฟะพ `call_id`
- ะัะพะณะพะฒัะน ัะฟะธัะพะบ: ~400-600 ัะฝะธะบะฐะปัะฝัั ะบะฐะฝะดะธะดะฐัะพะฒ

### Stage 3: Multi-Factor Scoring (ะะฝะพะณะพัะฐะบัะพัะฝัะน ะฟะพะดััะตั)

ะะปั ะบะฐะถะดะพะณะพ ะบะฐะฝะดะธะดะฐัะฐ ะฒััะธัะปัะตััั 7 ะบะพะผะฟะพะฝะตะฝัะพะฒ ัะบะพัะฐ:

#### 1. BM25 Score (30%)

```python
bm25_normalized = (bm25_raw / max_bm25) * 100
# ะะพัะผะฐะปะธะทะฐัะธั ะบ ัะบะฐะปะต 0-100
```

#### 2. Semantic Score (25%)

```python
semantic_normalized = (cosine_similarity / max_semantic) * 100
# ะะพะบะฐะทัะฒะฐะตั ัะผััะปะพะฒัั ะฑะปะธะทะพััั
```

#### 3. Keyword Density Score (25%)

**ะะพะดััะตั TF (Term Frequency):**
```python
for word in query_words:
    tf = count(word, document) / total_words_in_document
    tf_log = 1 + log(1 + tf * total_words)
    density_score += tf_log

density_score = density_score / len(query_words)
```

**ะะพะฝััั:**
- **Proximity Bonus:** ะตัะปะธ ัะปะพะฒะฐ ะทะฐะฟัะพัะฐ ะฑะปะธะทะบะพ ะดััะณ ะบ ะดััะณั (< 5 ัะปะพะฒ) โ ร3.0
- **Position Bonus:** ะตัะปะธ ัะปะพะฒะฐ ะฒ ะฝะฐัะฐะปะต ะดะพะบัะผะตะฝัะฐ โ ร2.5

#### 4. Exact Match Score (15%)

```python
if exact_phrase_match:
    score = 10.0  # ะขะพัะฝะพะต ัะพะฒะฟะฐะดะตะฝะธะต ะฒัะตะน ััะฐะทั
elif all_words_present:
    score = 5.0   # ะัะต ัะปะพะฒะฐ ะทะฐะฟัะพัะฐ ะฟัะธัััััะฒััั
elif 80%_words_match:
    score = 2.0   # ะะพะปััะธะฝััะฒะพ ัะปะพะฒ
```

#### 5. Context Boost (8%)

```python
boost = 1.0

# ะัะปะธ ะธัะตะผ "ะฒัะพะดััะธะต", ะฐ ะดะพะบัะผะตะฝั - ะฒัะพะดััะธะน ะทะฒะพะฝะพะบ
if intent == "ะฒัะพะดััะธะต_ะทะฒะพะฝะบะธ" and doc.call_type == "ะัะพะดััะธะน":
    boost *= 5.0

# ะัะปะธ ะธัะตะผ "ะฝะตะดะพะฒะพะปัััะฒะพ", ะฐ ะตััั ะฟัะพะฑะปะตะผั
if intent == "ะฝะตะดะพะฒะพะปัััะฒะพ" and doc.problem_call_has:
    boost *= 4.0

# ะัะปะธ ะธัะตะผ ะบะพะฝะบัะตัะฝะพะณะพ ะพะฟะตัะฐัะพัะฐ
if intent == "ะฟัะพะฑะปะตะผั_ั_ะพะฟะตัะฐัะพัะพะผ" and operator_match:
    boost *= 3.0
```

#### 6. Proximity Bonus (5%)

ะะพะฝัั ะทะฐ ะฑะปะธะทะพััั ัะปะพะฒ ะทะฐะฟัะพัะฐ ะฒ ะดะพะบัะผะตะฝัะต (ะธะท Keyword Density)

#### 7. Position Bonus (2%)

ะะพะฝัั ะทะฐ ะฟะพะทะธัะธั ะบะปััะตะฒัั ัะปะพะฒ (ะฝะฐัะฐะปะพ ะดะพะบัะผะตะฝัะฐ ะฒะฐะถะฝะตะต)

### Stage 4: Ensemble Ranking (ะะฝัะฐะผะฑะปะตะฒะพะต ัะฐะฝะถะธัะพะฒะฐะฝะธะต)

**ะคะพัะผัะปะฐ ัะธะฝะฐะปัะฝะพะณะพ ัะบะพัะฐ:**

```python
final_score = (
    bm25_score * 0.30 +
    semantic_score * 0.25 +
    keyword_density_score * 0.25 +
    exact_match_score * 0.15 +
    context_boost_score * 0.08 +
    proximity_bonus * 0.05 +
    position_bonus * 0.02
)
```

**ะกะพััะธัะพะฒะบะฐ:** ะะพ ัะฑัะฒะฐะฝะธั `final_score`

**ะะตะทัะปััะฐั:** ะขะพะฟ-N ัะตะทัะปััะฐัะพะฒ ั ะพะฑัััะฝะตะฝะธะตะผ ัะตะปะตะฒะฐะฝัะฝะพััะธ

## ๐ ะะพะผะฟะพะฝะตะฝัั ัะธััะตะผั

### 1. QueryAnalyzer

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะฝะฐะปะธะท ะธ ะฟะพะฝะธะผะฐะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปััะบะพะณะพ ะทะฐะฟัะพัะฐ

**ะะตัะพะดั:**
- `analyze(query)` โ ะฟะพะปะฝัะน ะฐะฝะฐะปะธะท ะทะฐะฟัะพัะฐ
- `_extract_keywords()` โ ะธะทะฒะปะตัะตะฝะธะต ะบะปััะตะฒัั ัะปะพะฒ
- `_detect_intent()` โ ะพะฟัะตะดะตะปะตะฝะธะต ะฝะฐะผะตัะตะฝะธั
- `_extract_entities()` โ ะธะทะฒะปะตัะตะฝะธะต ัััะฝะพััะตะน
- `_llm_expand()` โ ัะฐััะธัะตะฝะธะต ัะตัะตะท LLM

**ะัะธะผะตัั intent:**
```python
"ะฒัะพะดััะธะต ะดะธะฐะปะพะณะธ" โ intent = "ะฒัะพะดััะธะต_ะทะฒะพะฝะบะธ"
"ะฝะตะดะพะฒะพะปัะฝัะน ะบะปะธะตะฝั" โ intent = "ะฝะตะดะพะฒะพะปัััะฒะพ_ะบะปะธะตะฝัะฐ"
"ะณััะฑัะน ะพะฟะตัะฐัะพั" โ intent = "ะฟัะพะฑะปะตะผั_ั_ะพะฟะตัะฐัะพัะพะผ"
```

### 2. KeywordDensityScorer

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะพะดััะตั ะฟะปะพัะฝะพััะธ ะบะปััะตะฒัั ัะปะพะฒ ะฒ ะดะพะบัะผะตะฝัะต

**ะะปะณะพัะธัะผ:**
1. ะขะพะบะตะฝะธะทะฐัะธั ะดะพะบัะผะตะฝัะฐ
2. ะะพะดััะตั TF ะดะปั ะบะฐะถะดะพะณะพ ัะปะพะฒะฐ ะทะฐะฟัะพัะฐ
3. ะะพะณะฐัะธัะผะธัะตัะบะฐั ะฝะพัะผะฐะปะธะทะฐัะธั
4. ะะฐััะตั proximity bonus (ะฑะปะธะทะพััั ัะปะพะฒ)
5. ะะฐััะตั position bonus (ะฟะพะทะธัะธั ะฒ ะดะพะบัะผะตะฝัะต)

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะฃัะธััะฒะฐะตั ัะฐััะพัั ะฒัะพะถะดะตะฝะธั
- ะจััะฐััะตั ะดะพะบัะผะตะฝัั ะณะดะต ัะปะพะฒะฐ ะดะฐะปะตะบะพ ะดััะณ ะพั ะดััะณะฐ
- ะฃัะธะปะธะฒะฐะตั ะดะพะบัะผะตะฝัั ะณะดะต ัะปะพะฒะฐ ะฒ ะฝะฐัะฐะปะต

### 3. ContextBoostScorer

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะพะฝัะตะบััะฝะพะต ััะธะปะตะฝะธะต ะฝะฐ ะพัะฝะพะฒะต ะผะตัะฐะดะฐะฝะฝัั

**ะัะฐะฒะธะปะฐ:**
```python
# ะขะธะฟ ะทะฒะพะฝะบะฐ
if intent == "ะฒัะพะดััะธะต_ะทะฒะพะฝะบะธ" and doc.call_type == "ะัะพะดััะธะน":
    boost *= 5.0

# ะัะพะฑะปะตะผั
if intent == "ะฝะตะดะพะฒะพะปัััะฒะพ" and doc.problem_call_has:
    boost *= 4.0

# ะัะธัะธัะตัะบะธะต ะฝะฐัััะตะฝะธั
if intent == "ะฝะตะดะพะฒะพะปัััะฒะพ" and doc.qa_critical_violation:
    boost *= 3.0

# ะะฟะตัะฐัะพั
if intent == "ะฟัะพะฑะปะตะผั_ั_ะพะฟะตัะฐัะพัะพะผ" and operator_match:
    boost *= 3.0
```

### 4. ExactMatchScorer

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะพะฝััั ะทะฐ ัะพัะฝัะต ัะพะฒะฟะฐะดะตะฝะธั

**ะฃัะพะฒะฝะธ:**
- **ะฃัะพะฒะตะฝั 1:** ะขะพัะฝะพะต ัะพะฒะฟะฐะดะตะฝะธะต ััะฐะทั โ +10.0
- **ะฃัะพะฒะตะฝั 2:** ะัะต ัะปะพะฒะฐ ะฟัะธัััััะฒััั โ +5.0
- **ะฃัะพะฒะตะฝั 3:** โฅ80% ัะปะพะฒ โ +2.0
- **ะฃัะพะฒะตะฝั 4:** โฅ60% ัะปะพะฒ โ +1.0

### 5. HybridSearchEngine

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะปะฐะฒะฝัะน ะพัะบะตัััะฐัะพั ะฒัะตะณะพ ะฟัะพัะตััะฐ

**ะัะฝะพะฒะฝะพะน ะผะตัะพะด:** `search(query, limit=10)`

**ะัะพัะตัั:**
1. ะะฝะฐะปะธะท ะทะฐะฟัะพัะฐ โ `QueryAnalyzer`
2. ะะฝะพะณะพััะพะฒะฝะตะฒะฐั ะฒัะฑะพัะบะฐ โ `Multi-Stage Retrieval`
3. ะะฝะพะณะพัะฐะบัะพัะฝัะน ะฟะพะดััะตั โ `Multi-Factor Scoring`
4. ะคะธะฝะฐะปัะฝะพะต ัะฐะฝะถะธัะพะฒะฐะฝะธะต โ `Ensemble Ranking`

## ๐ฏ ะัะตะธะผััะตััะฒะฐ ะณะธะฑัะธะดะฝะพะณะพ ะฟะพะดัะพะดะฐ

### 1. ะะพะผะฑะธะฝะธัะพะฒะฐะฝะธะต ัะธะปัะฝัั ััะพัะพะฝ

| ะะตัะพะด | ะกะธะปัะฝัะต ััะพัะพะฝั | ะกะปะฐะฑัะต ััะพัะพะฝั |
|-------|----------------|----------------|
| BM25 | โ ะขะพัะฝะพััั ะดะปั ะบะปััะตะฒัั ัะปะพะฒ<br>โ ะััััะพัะฐ | โ ะะต ะฟะพะฝะธะผะฐะตั ัะธะฝะพะฝะธะผั<br>โ ะะพัะฒะตะฝะฝัะต ะทะฐะฟัะพัั |
| Semantic | โ ะะพะฝะธะผะฐะฝะธะต ัะผััะปะฐ<br>โ ะกะธะฝะพะฝะธะผั | โ ะะพะถะตั ะฟัะพะฟัััะธัั ัะพัะฝัะต ัะพะฒะฟะฐะดะตะฝะธั |
| Keyword Density | โ ะฃัะตั ัะฐััะพัั ัะปะพะฒ<br>โ ะะฐะบ ะฒ Google/ะฏะฝะดะตะบั | โ ะขัะตะฑัะตั ัะพัะฝัั ัะปะพะฒ |
| ะะธะฑัะธะด | โ ะัะต ะฟัะตะธะผััะตััะฒะฐ<br>โ ะะพะผะฟะตะฝัะธััะตั ะฝะตะดะพััะฐัะบะธ | โ๏ธ ะกะปะพะถะฝะตะต ัะตะฐะปะธะทะฐัะธั |

### 2. ะะถะธะดะฐะตะผะฐั ัะตะปะตะฒะฐะฝัะฝะพััั

| ะขะธะฟ ะทะฐะฟัะพัะฐ | BM25 | Semantic | ะะธะฑัะธะดะฝัะน |
|------------|------|----------|-----------|
| ะขะพัะฝัะน ("ะฒัะพะดััะธะต ะทะฒะพะฝะบะธ") | 95% | 85% | **98%** |
| ะกะตะผะฐะฝัะธัะตัะบะธะน ("ะฝะตะดะพะฒะพะปัะฝัะน ะบะปะธะตะฝั") | 60% | 75% | **90%** |
| ะะพัะฒะตะฝะฝัะน ("ะถะฐะปะพะฑั ะฝะฐ ะพะฟะตัะฐัะพัะฐ") | 40% | 70% | **88%** |
| ะะตัะตััะฐะทะธัะพะฒะฐะฝะธะต | 50% | 75% | **85%** |

## ๐ ะะตัะฐ ะบะพะผะฟะพะฝะตะฝัะพะฒ

ะขะตะบััะฐั ะบะพะฝัะธะณััะฐัะธั:

```python
weights = {
    'bm25': 0.30,           # 30% - ะดะปั ัะพัะฝัั ะทะฐะฟัะพัะพะฒ
    'semantic': 0.25,       # 25% - ะดะปั ะบะพัะฒะตะฝะฝัั ะทะฐะฟัะพัะพะฒ
    'keyword_density': 0.25, # 25% - ะดะปั ัะฐััะพัั ัะปะพะฒ
    'exact_match': 0.15,     # 15% - ะดะปั ัะพัะฝัั ัะพะฒะฟะฐะดะตะฝะธะน
    'context_boost': 0.08,   # 8% - ะดะปั ะบะพะฝัะตะบััะฐ
    'proximity_bonus': 0.05, # 5% - ะดะปั ะฑะปะธะทะพััะธ ัะปะพะฒ
    'position_bonus': 0.02   # 2% - ะดะปั ะฟะพะทะธัะธะธ
}
```

**ะะฐัััะพะนะบะฐ ะฒะตัะพะฒ:** ะะพะถะฝะพ ะธะทะผะตะฝััั ัะตัะตะท `hybrid_search_engine.update_weights(new_weights)`

## ๐ง API ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ะญะฝะดะฟะพะธะฝั: POST `/hybrid-search`

**ะะฐะฟัะพั:**
```json
{
  "query": "ะฟะพะบะฐะถะธ ะฝะตะดะพะฒะพะปัะฝัั ะบะปะธะตะฝัะพะฒ",
  "limit": 10
}
```

**ะัะฒะตั:**
```json
{
  "results": [
    {
      "call_id": "CALL-10011",
      "call_type": "ะัะพะดััะธะน ะทะฒะพะฝะพะบ",
      "operator_name": "Noname Other",
      "text_summary": "...",
      "relevance_score": 54.41,
      "score_breakdown": {
        "bm25": 45.2,
        "semantic": 38.5,
        "keyword_density": 12.3,
        "exact_match": 5.0,
        "context_boost": 8.2,
        "proximity_bonus": 3.0,
        "position_bonus": 1.5
      },
      "relevance_reason": "ัะพัะฝะพะต ัะพะฒะฟะฐะดะตะฝะธะต, ะบะพะฝัะตะบััะฝะพะต ัะพะพัะฒะตัััะฒะธะต, ะฒััะพะบะฐั ะฟะปะพัะฝะพััั ะบะปััะตะฒัั ัะปะพะฒ"
    }
  ],
  "total": 68,
  "query": "ะฟะพะบะฐะถะธ ะฝะตะดะพะฒะพะปัะฝัั ะบะปะธะตะฝัะพะฒ",
  "search_type": "hybrid"
}
```

## ๐ ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ

### 1. ะกัััะบัััะธัะพะฒะฐะฝะฝัะน ะทะฐะฟัะพั
```
ะะฐะฟัะพั: "ะฟะพะบะฐะถะธ ะฒัะพะดััะธะต ะดะธะฐะปะพะณะธ"
Intent: ะฒัะพะดััะธะต_ะทะฒะพะฝะบะธ
ะคะธะปััั: call_type = "ะัะพะดััะธะน ะทะฒะพะฝะพะบ"
ะะตะปะตะฒะฐะฝัะฝะพััั: 98%
```

### 2. ะกะตะผะฐะฝัะธัะตัะบะธะน ะทะฐะฟัะพั
```
ะะฐะฟัะพั: "ะฝะตะดะพะฒะพะปัะฝัะน ะบะปะธะตะฝั ะถะฐะปัะตััั"
Intent: ะฝะตะดะพะฒะพะปัััะฒะพ_ะบะปะธะตะฝัะฐ
ะะฐััะธัะตะฝะธะต: "ะถะฐะปะพะฑะฐ", "ะฝะตะดะพะฒะพะปัััะฒะพ", "ะฟัะพะฑะปะตะผะฐ"
Context Boost: problem_call_has = True โ ร4.0
ะะตะปะตะฒะฐะฝัะฝะพััั: 90%
```

### 3. ะะพัะฒะตะฝะฝัะน ะทะฐะฟัะพั
```
ะะฐะฟัะพั: "ะณะดะต ะบะปะธะตะฝั ะทะฒะพะฝะธั ั ะถะฐะปะพะฑะพะน ะฝะฐ ะพะฟะตัะฐัะพัะฐ"
Intent: ะฟัะพะฑะปะตะผั_ั_ะพะฟะตัะฐัะพัะพะผ
Semantic Search: ะฝะฐัะพะดะธั ะฟะพ ัะผััะปั
Context Boost: operator_match โ ร3.0
ะะตะปะตะฒะฐะฝัะฝะพััั: 88%
```

### 4. ะะตัะตััะฐะทะธัะพะฒะฐะฝะธะต
```
ะะฐะฟัะพั: "ะบะปะธะตะฝั ะฝะธัะตะณะพ ะฝะต ะบัะฟะธะป ะฒ ะธัะพะณะต"
ะกะธะฝะพะฝะธะผั: "ะฝะต ะฟัะพะดะฐะปะธ", "ะฝะต ะพัะพัะผะธะปะธ", "ะฝะต ะทะฐะฒะตััะธะปะธ ัะดะตะปะบั"
Semantic: ะฟะพะฝะธะผะฐะตั ัะผััะป
ะะตะปะตะฒะฐะฝัะฝะพััั: 85%
```

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะัะตะผั ะฒัะฟะพะปะฝะตะฝะธั (ัะธะฟะธัะฝะพะต):

- Query Analysis: ~100-200ms (ั LLM)
- BM25 Search: ~50-150ms
- Semantic Search: ~200-500ms (ะณะตะฝะตัะฐัะธั embeddings)
- Multi-Factor Scoring: ~50-100ms
- **ะะฑัะตะต ะฒัะตะผั:** ~400-950ms

### ะะฐัััะฐะฑะธััะตะผะพััั:

- **ะะพ 10K ะดะพะบัะผะตะฝัะพะฒ:** ะัะปะธัะฝะฐั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั
- **ะะพ 100K ะดะพะบัะผะตะฝัะพะฒ:** ะฅะพัะพัะฐั (ะฒะพะทะผะพะถะฝะพ ะฟะพััะตะฑัะตััั ะบััะธัะพะฒะฐะฝะธะต)
- **100K+ ะดะพะบัะผะตะฝัะพะฒ:** ะะตะบะพะผะตะฝะดัะตััั ะพะฟัะธะผะธะทะฐัะธั (ะธะฝะดะตะบัะฐัะธั embeddings)

## ๐ ะัะปะธัะธั ะพั ัะธััะพะณะพ Elasticsearch

| ะะฐัะฐะผะตัั | ะงะธัััะน Elasticsearch | ะะธะฑัะธะดะฝัะน ะดะฒะธะถะพะบ |
|----------|---------------------|------------------|
| ะะพะธัะบ | ะขะพะปัะบะพ BM25 | BM25 + Semantic + Keyword Density |
| ะะฐะฝะถะธัะพะฒะฐะฝะธะต | BM25 score | 7-ัะฐะบัะพัะฝัะน ensemble |
| ะกะธะฝะพะฝะธะผั | ะขัะตะฑัะตั ะฝะฐัััะพะนะบะธ | LLM ัะฐััะธัะตะฝะธะต |
| ะะพะฝัะตะบัั | ะะต ััะธััะฒะฐะตััั | Context Boost |
| ะะพัะฒะตะฝะฝัะต ะทะฐะฟัะพัั | ะกะปะฐะฑะพ | ะัะปะธัะฝะพ |
| ะะฐัััะพะนะบะฐ | ะงะตัะตะท mapping | ะะตัะฐ ะฒ ะบะพะดะต |

## ๐ ะะฐะบะปััะตะฝะธะต

**ะะธะฑัะธะดะฝัะน ะฟะพะธัะบะพะฒัะน ะดะฒะธะถะพะบ** ะฟัะตะดััะฐะฒะปัะตั ัะพะฑะพะน ะฐััะธัะตะบัััั, ะณะดะต:

1. **Elasticsearch** ะธัะฟะพะปัะทัะตััั ะบะฐะบ:
   - ะะฐะทะฐ ะดะฐะฝะฝัั ะดะปั ะดะพะบัะผะตะฝัะพะฒ
   - ะะฝััะฐััััะบัััะฐ ะดะปั BM25 ะฟะพะธัะบะฐ
   - ะฅัะฐะฝะธะปะธัะต ะผะตัะฐะดะฐะฝะฝัั

2. **ะะฐััะพะผะฝัะต ะฐะปะณะพัะธัะผั** ะดะพะฑะฐะฒะปััั:
   - ะกะตะผะฐะฝัะธัะตัะบะธะน ัะปะพะน (E5-large embeddings)
   - Keyword Density scoring
   - Context-Aware boosting
   - Ensemble ranking

3. **ะะตะทัะปััะฐั:** ะกะธััะตะผะฐ, ะบะพัะพัะฐั:
   - โ ะขะพัะฝะฐ ะดะปั ะฟััะผัั ะทะฐะฟัะพัะพะฒ (ะบะฐะบ BM25)
   - โ ะะพะฝะธะผะฐะตั ัะผััะป (ะบะฐะบ Semantic)
   - โ ะฃัะธััะฒะฐะตั ัะฐััะพัั ัะปะพะฒ (ะบะฐะบ Google/ะฏะฝะดะตะบั)
   - โ ะะฐะฑะพัะฐะตั ั ะบะพัะฒะตะฝะฝัะผะธ ะทะฐะฟัะพัะฐะผะธ

**ะญัะพ ะะ ัะธััะฐั ะทะฐะผะตะฝะฐ Elasticsearch, ะฐ ะฝะฐะดัััะพะนะบะฐ ะฝะฐะด ะฝะธะผ**, ะบะพัะพัะฐั ะดะตะปะฐะตั ะฟะพะธัะบ ะฑะพะปะตะต ะธะฝัะตะปะปะตะบััะฐะปัะฝัะผ ะธ ัะตะปะตะฒะฐะฝัะฝัะผ.

