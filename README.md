# üîç –ì–∏–±—Ä–∏–¥–Ω—ã–π –ü–æ–∏—Å–∫–æ–≤—ã–π –î–≤–∏–∂–æ–∫

–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ —Å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è BM25, Semantic Search, Keyword Density –∏ Context-Aware Boost.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫**: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è BM25 (30%) + Semantic (25%) + Keyword Density (25%) + –¥—Ä—É–≥–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã
- ‚úÖ **–í—ã—Å–æ–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å**: 90-98% –¥–∞–∂–µ –¥–ª—è –∫–æ—Å–≤–µ–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **–ü–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **Elasticsearch –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Elasticsearch –∫–∞–∫ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ BM25 –ø–æ–∏—Å–∫
- ‚úÖ **E5-large embeddings**: –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–æ–π –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å–º—ã—Å–ª–∞
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ–π UI**: –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –æ–¥–Ω–æ–π –ø–æ–∏—Å–∫–æ–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
HybridSearchEngine
‚îú‚îÄ‚îÄ QueryAnalyzer          # –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞ (Intent, Keywords, LLM Expansion)
‚îú‚îÄ‚îÄ Multi-Stage Retrieval   # BM25 (500) + Semantic (100) ‚Üí Merge
‚îú‚îÄ‚îÄ Scoring Engine         # 7-—Ñ–∞–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç –æ—á–∫–æ–≤
‚îî‚îÄ‚îÄ Ensemble Ranking       # –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ
```

**–û—Å–Ω–æ–≤–∞**: Elasticsearch –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ BM25 –ø–æ–∏—Å–∫–∞  
**–ù–∞–¥—Å—Ç—Ä–æ–π–∫–∞**: –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–≤–µ—Ä—Ö ES

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- Python 3.11+ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- Elasticsearch 8.11.0 (—á–µ—Ä–µ–∑ Docker)
- PostgreSQL 15 (—á–µ—Ä–µ–∑ Docker, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- LLM —Å–µ—Ä–≤–µ—Ä (LMStudio/Ollama, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤)
- E5-large –º–æ–¥–µ–ª—å embeddings (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø—É—Ç—å: `/models/embeddings/intfloat_multilingual-e5-large`)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
```bash
git clone <repository-url>
cd hybrid_search_engine
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É:**
```bash
docker-compose up -d
```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:**
```bash
curl http://localhost:8005/health
```

5. **–û—Ç–∫—Ä–æ–π—Ç–µ UI:**
```
http://localhost:8503
```

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. API (FastAPI)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `POST /search` - –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```python
import requests

response = requests.post("http://localhost:8005/search", json={
    "query": "–ø–æ–∫–∞–∂–∏ –≤—Ö–æ–¥—è—â–∏–µ –¥–∏–∞–ª–æ–≥–∏",
    "limit": 10
})

results = response.json()
for result in results["results"]:
    print(f"{result['call_id']} - {result['operator_name']} (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: {result['relevance_score']:.2f})")
```

### 2. UI (Streamlit)

–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –æ–¥–Ω–æ–π –ø–æ–∏—Å–∫–æ–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫.

### 3. –ì–∏–±—Ä–∏–¥–Ω—ã–π –¥–≤–∏–∂–æ–∫

**–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å:** `HybridSearchEngine`

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `QueryAnalyzer` - –∞–Ω–∞–ª–∏–∑ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- `KeywordDensityScorer` - –ø–æ–¥—Å—á–µ—Ç –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
- `ContextBoostScorer` - –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ —É—Å–∏–ª–µ–Ω–∏–µ
- `ExactMatchScorer` - —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### Python –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```python
from hybrid_search import HybridSearchEngine

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
engine = HybridSearchEngine(
    elasticsearch_url="http://localhost:9200",
    llm_url="http://localhost:1234",  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    embedding_model=None  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å E5-large
)

# –ü–æ–∏—Å–∫
results = engine.search("–ø–æ–∫–∞–∂–∏ –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤", limit=10)

for item in results["results"]:
    print(f"{item['call_id']} - {item['operator_name']}")
    print(f"–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: {item['semantic_score']:.2f}")
    print(f"–ü—Ä–∏—á–∏–Ω–∞: {item['relevance_reason']}")
```

### REST API

```bash
# –ü–æ–∏—Å–∫
curl -X POST "http://localhost:8005/search" \
  -H "Content-Type: application/json" \
  -d '{"query": "–Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç", "limit": 5}'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
curl http://localhost:8005/health
```

### Elasticsearch –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏ Elasticsearch. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞:

```json
{
  "call_id": "CALL-123",
  "call_type": "–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫",
  "operator_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω",
  "text_full": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞...",
  "text_summary": "–ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ...",
  "qa_total_score": 85,
  "qa_critical_violation": false,
  "problem_call_has": true,
  "tags": ["–ø—Ä–æ–±–ª–µ–º–∞", "–Ω–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ"],
  "empathy_count": 3,
  "no_go_count": 0
}
```

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Elasticsearch
ELASTICSEARCH_URL=http://elasticsearch:9200
ELASTICSEARCH_INDEX=call_dialogues

# LLM (–¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤)
LLM_URL=http://localhost:1234

# Embedding –º–æ–¥–µ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
EMBEDDING_MODEL_PATH=/models/embeddings/intfloat_multilingual-e5-large

# API
API_BASE_URL=http://api:8000
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ—Å–æ–≤ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è

```python
# –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
engine.update_weights({
    'bm25': 0.35,           # –£–≤–µ–ª–∏—á–∏—Ç—å BM25
    'semantic': 0.20,       # –£–º–µ–Ω—å—à–∏—Ç—å Semantic
    'keyword_density': 0.30,
    'exact_match': 0.10,
    'context_boost': 0.05
})
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞**: 400-950ms (—Ç–∏–ø–∏—á–Ω–æ–µ)
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –î–æ 100K –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–¢–æ—á–Ω–æ—Å—Ç—å**: 90-98% —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `docs/`:
- `HYBRID_SEARCH_DOCUMENTATION.md` - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- `HYBRID_SEARCH_DESIGN.md` - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –¥–∏–∑–∞–π–Ω

## üîç –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
```
"–ø–æ–∫–∞–∂–∏ –≤—Ö–æ–¥—è—â–∏–µ –¥–∏–∞–ª–æ–≥–∏"
‚Üí –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: 98%
```

### –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
```
"–Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –∂–∞–ª—É–µ—Ç—Å—è"
‚Üí –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: 90%
```

### –ö–æ—Å–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
```
"–≥–¥–µ –∫–ª–∏–µ–Ω—Ç –∑–≤–æ–Ω–∏—Ç —Å –∂–∞–ª–æ–±–æ–π –Ω–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞"
‚Üí –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: 88%
```

### –ü–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
```
"–∫–ª–∏–µ–Ω—Ç –Ω–∏—á–µ–≥–æ –Ω–µ –∫—É–ø–∏–ª –≤ –∏—Ç–æ–≥–µ"
‚Üí –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: 85%
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# API
cd app
uvicorn api:app --reload --port 8005

# UI
cd ui
streamlit run simple_search_ui.py --server.port 8503
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç API
curl -X POST "http://localhost:8005/search" \
  -H "Content-Type: application/json" \
  -d '{"query": "—Ç–µ—Å—Ç", "limit": 5}'
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

| –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | BM25 —Ç–æ–ª—å–∫–æ | Semantic —Ç–æ–ª—å–∫–æ | –ì–∏–±—Ä–∏–¥–Ω—ã–π |
|------------|-------------|-----------------|-----------|
| –¢–æ—á–Ω—ã–π | 95% | 85% | **98%** |
| –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π | 60% | 75% | **90%** |
| –ö–æ—Å–≤–µ–Ω–Ω—ã–π | 40% | 70% | **88%** |
| –ü–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞–Ω–∏–µ | 50% | 75% | **85%** |

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è pull requests! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
1. –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∏–ª—é –ø—Ä–æ–µ–∫—Ç–∞
2. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT Lisense

## üë• –ê–≤—Ç–æ—Ä

Vasiliy Dautov

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- Elasticsearch –∑–∞ –æ—Ç–ª–∏—á–Ω—É—é –ø–æ–∏—Å–∫–æ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
- Sentence Transformers –∑–∞ embedding –º–æ–¥–µ–ª–∏
- Streamlit –∑–∞ –ø—Ä–æ—Å—Ç–æ–π UI —Ñ—Ä–µ–π–º–≤–æ—Ä–∫

